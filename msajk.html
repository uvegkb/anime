<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…Ø²Ø§Ø¬Ùƒ Ø£Ù†Ù…ÙŠ â€” Ù…Ø¹ Ù‚Ø§Ø¹Ø¯Ø© 500 Ø£Ù†Ù…ÙŠ</title>
  <meta name="description" content="Anime Universe Ù‡Ùˆ Ù…ÙˆÙ‚Ø¹ Ø´Ø§Ù…Ù„ Ù„Ø¹Ø´Ø§Ù‚ Ø§Ù„Ø£Ù†Ù…ÙŠ! Ø§ÙƒØªØ´Ù Ø£Ø­Ø¯Ø« ÙˆØ£Ø´Ù‡Ø± Ø§Ù„Ø£Ù†Ù…ÙŠØ§ØªØŒ Ø§Ù„Ù…Ø§Ù†Ø¬Ø§ØŒ Ø´Ø®ØµÙŠØ§Øª Ø§Ù„Ø£Ù†Ù…ÙŠØŒ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ØŒ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±ØŒ ÙˆØ§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ø£Ù†Ù…ÙŠ. ØªØµÙØ­ Ø¨Ø³Ù‡ÙˆÙ„Ø© Ù…Ø¹ ÙˆØ§Ø¬Ù‡Ø© Ø£Ù†Ù…ÙŠØ´Ù† Ø¬Ø°Ø§Ø¨Ø© ÙˆØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø³Ù„Ø³Ø©.">

  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7c3aed;--glass:rgba(255,255,255,0.04);--muted:rgba(255,255,255,0.6)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, "Noto Kufi Arabic", Tahoma, Arial;color:#fff;background:linear-gradient(180deg,#071024 0%, #071028 60%)}
    .wrap{max-width:980px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    header h1{font-size:1.4rem;margin:0}
    header p{margin:0;color:var(--muted);font-size:0.95rem}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));border-radius:14px;padding:18px;margin-bottom:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .question{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px}
    .option{padding:12px;border-radius:10px;background:var(--glass);text-align:center;cursor:pointer;user-select:none;border:1px solid rgba(255,255,255,0.03)}
    .option.active{outline:3px solid rgba(124,58,237,0.18);transform:translateY(-3px)}
    .btn-row{display:flex;gap:8px;justify-content:flex-start;margin-top:12px}
    button{background:var(--accent);border:0;padding:10px 14px;border-radius:10px;color:#fff;font-weight:700;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);font-weight:600}
    .result{display:flex;gap:12px;align-items:center}
    .poster{width:120px;height:160px;border-radius:10px;background:#122132;flex:0 0 120px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:700}
    .meta{flex:1}
    .meta h2{margin:0 0 6px 0}
    .meta p{margin:0;color:var(--muted)}
    footer{color:var(--muted);text-align:center;font-size:0.9rem;margin-top:8px}
    @media(max-width:600px){.wrap{padding:10px} .poster{width:95px;height:130px}}
    .fade-in{animation:fadeIn .35s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
    .tag{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.02);font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Ù…Ø²Ø§Ø¬Ùƒ Ø£Ù†Ù…ÙŠ ğŸ­</h1>
        <p>Ø§Ù†Ù…ÙŠ Ø­Ø³Ø¨ Ù…Ø²Ø§Ø¬Ùƒ <strong>500 Ø£Ù†Ù…ÙŠ</strong> (Ø§ÙƒØ«Ø± Ù…Ù† 500 Ø§Ù†Ù…ÙŠ Ù…Ù† ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±Ùƒ)</p>
      </div>                                                                                                       
      <div style="text-align:left">
        <p class="tag">Ø¬Ø§Ù‡Ø²:Ø§Ø¨Ø¯Ø§Ø¡ Ø±Ø­Ù„ØªÙƒ</p>
      </div>
    </header>

    <main>
      <section id="step-1" class="card fade-in">
        <h3>1. ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„Ø¢Ù†ØŸ</h3>
        <div class="question" id="moods">
          <div class="option" data-val="merry">Ù…Ø¨Ø³ÙˆØ· ğŸ˜„</div>
          <div class="option" data-val="bored">Ø²Ù‡Ù‚Ø§Ù† ğŸ˜’</div>
          <div class="option" data-val="sad">Ø­Ø²ÙŠÙ† ğŸ˜¢</div>
          <div class="option" data-val="romance">Ø¨Ø¯Ù‘ÙŠ Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© ğŸ’•</div>
          <div class="option" data-val="excited">Ù†Ø´ÙŠØ·/Ø¥Ø«Ø§Ø±Ø© âš”ï¸</div>
        </div>
      </section>

      <section id="step-2" class="card fade-in">
        <h3>2. ØªÙØ¶Ù‘Ù„ØŸ</h3>
        <div class="question" id="lengths">
          <div class="option" data-val="short">Ø³Ø±ÙŠØ¹ (ÙÙŠÙ„Ù… / Ø£ÙˆÙØ§)</div>
          <div class="option" data-val="tv">Ø³Ù„Ø³Ù„Ø© Ù‚ØµÙŠØ±Ø© (12 Ø­Ù„Ù‚Ø©)</div>
          <div class="option" data-val="long">Ø³Ù„Ø³Ù„Ø© Ø·ÙˆÙŠÙ„Ø©</div>
        </div>
      </section>

      <section id="step-3" class="card fade-in">
        <h3>3. Ù…Ø¹ Ù…Ù† Ø±Ø­ ØªØªÙØ±Ø¬ØŸ</h3>
        <div class="question" id="company">
          <div class="option" data-val="alone">Ù„ÙˆØ­Ø¯ÙŠ</div>
          <div class="option" data-val="friends">Ù…Ø¹ Ø£ØµØ­Ø§Ø¨</div>
          <div class="option" data-val="date">Ù…Ø¹ Ø­Ø¨ÙŠØ¨Ø©/Ø­Ø¨ÙŠØ¨ ğŸ’˜</div>
        </div>
      </section>

      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
          <div style="color:var(--muted)">Ø§Ø¶ØºØ· "Ø§Ù‚ØªØ±Ø­ Ù„ÙŠ" Ù„Ø£Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ Ø£Ù†Ù…ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ</div>
          <div>
            <button id="suggestBtn">Ø§Ù‚ØªØ±Ø­ Ù„ÙŠ</button>
            <button class="secondary" id="randomBtn">Ø§Ù‚ØªØ±Ø­ Ø¹Ø´ÙˆØ§Ø¦ÙŠ ğŸ²</button>
          </div>
        </div>
      </div>

      <section id="result" class="card" style="display:none">
        <div class="result">
          <div class="poster" id="poster">ØµÙˆØ±Ø©</div>
          <div class="meta">
            <h2 id="title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø£Ù†Ù…ÙŠ</h2>
            <p id="tags">#Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ Â· #ÙÙŠÙ„Ù…</p>
            <p id="desc" style="margin-top:8px;color:var(--muted)">ÙˆØµÙ Ù‚ØµÙŠØ± Ù„Ù„Ø£Ù†Ù…ÙŠ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§.</p>
            <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
              <button id="favBtn">Ø§Ø¶Ù Ù„Ù„Ù…ÙØ¶Ù„Ø© â˜†</button>
              <button id="shareBtn" class="secondary">Ø§Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ğŸ”—</button>
              <button id="openBtn" class="secondary">Ø´Ø§Ù‡Ø¯ Ù…Ù„Ø®Øµ (ÙŠÙˆØªÙŠÙˆØ¨)</button>
            </div>
          </div>
        </div>
      </section>

      <section class="card">
        <h4>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</h4>
        <p style="color:var(--muted)">Ø§Ù„Ù…Ù„Ù <code>anime_db.json</code> Ù…ÙˆÙ‚Ø¹ Ø§Ù†Ù…ÙŠ Ø­Ø³Ø¨ Ù…Ø²Ø§Ø¬Ùƒ Ø§Ø®ØªÙŠØ§Ø±Ùƒ ÙŠÙ‡Ù…Ù†Ø§</p>
      </section>                                                                                                                           

    </main>

    <footer>
      Ø§ÙØ¶Ù„ Ù…ÙˆÙ‚Ø¹ Ù„ÙŠØ¹Ø·ÙŠÙƒ Ø®ÙŠØ§Ø± Ø§Ù†Ù…ÙŠ Ø­Ø³Ø¨ Ù…Ø²Ø§Ø¬Ùƒ<strong>abdullah</strong> â€” json <code>/anime_mzagk</code>
    </footer>                                                                                                                  
  </div>

<script>
  const FALLBACK_DB = null;
  let ANIME_DB = [];

  function initFromData(data){
    ANIME_DB = data;
  }

  async function loadDB(){
    try{
      const resp = await fetch('anime_db.json');
      if(!resp.ok) throw new Error('fetch failed');
      const data = await resp.json();
      initFromData(data);
      console.log('Loaded anime_db.json with', data.length, 'entries');
    }catch(e){
      console.warn('Failed to load anime_db.json; using embedded DB if available.', e);
      if(FALLBACK_DB){
        initFromData(FALLBACK_DB);
      } else {
        ANIME_DB = [];
      }
    }
  }

  const suggestBtn = document.getElementById('suggestBtn');
  const randomBtn = document.getElementById('randomBtn');
  const resultBox = document.getElementById('result');
  const poster = document.getElementById('poster');
  const titleEl = document.getElementById('title');
  const tagsEl = document.getElementById('tags');
  const descEl = document.getElementById('desc');
  const shareBtn = document.getElementById('shareBtn');
  const favBtn = document.getElementById('favBtn');
  const openBtn = document.getElementById('openBtn');

  const state = {mood:null,length:null,company:null};

  document.querySelectorAll('.option').forEach(el=>{
    el.addEventListener('click',()=>{
      const group = el.parentElement.id;
      el.parentElement.querySelectorAll('.option').forEach(o=>o.classList.remove('active'));
      el.classList.add('active');
      const val = el.dataset.val;
      if(group === 'moods') state.mood = val;
      if(group === 'lengths') state.length = val;
      if(group === 'company') state.company = val;
    });
  });

  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } }

  function pickAnime(filterFn){
    const pool = ANIME_DB.filter(filterFn);
    if(pool.length === 0) return null;
    shuffle(pool);
    return pool[0];
  }

  function suggest(){
    if(!state.mood || !state.length || !state.company){
      alert('ÙŠØ¨Ø¯Ùˆ Ø£Ù†Ùƒ Ù„Ù… ØªØ®ØªØ± ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© â€” Ø§Ø®ØªØ± Ø®ÙŠØ§Ø±Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ ÙÙŠ ÙƒÙ„ Ù‚Ø³Ù….');
      return;
    }
    const moodMap = {
      merry:['mellow','romance'],
      bored:['tv','short'],
      sad:['sad','drama'],
      romance:['romance'],
      excited:['action','excited']
    };
    const wanted = new Set();
    (moodMap[state.mood]||[]).forEach(t=>wanted.add(t));
    if(state.length === 'short') wanted.add('movie');
    if(state.length === 'tv') wanted.add('tv');
    if(state.company === 'date') wanted.add('date');
    if(state.company === 'friends') wanted.add('action');
    const result = pickAnime(a=>{
      for(let t of a.tags){ if(wanted.has(t)) return true; }
      if(state.length === 'short' && a.tags.includes('movie')) return true;
      if(state.length === 'tv' && a.tags.includes('tv')) return true;
      return false;
    }) || pickAnime(()=>true);
    showResult(result);
    pushURL(result?.id);
  }

  function suggestRandom(){
    if(ANIME_DB.length===0){ alert('Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù… ØªÙØ­Ù…Ù‘Ù„ Ø¨Ø¹Ø¯. Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø®Ø§Ø¯Ù… Ù…Ø­Ù„ÙŠ Ø£Ùˆ Ø§Ø±ÙØ¹ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¶Ø§ÙØ©.'); return; }
    const r = ANIME_DB[Math.floor(Math.random()*ANIME_DB.length)];
    showResult(r);                                                                                                               
    pushURL(r.id);
  }

  function showResult(a){
    if(!a) return;
    resultBox.style.display = 'block';
    titleEl.textContent = a.title;
    tagsEl.textContent = a.tags.map(t=>`#${t}`).join(' Â· ');
    descEl.textContent = a.desc;
    poster.textContent = a.title.slice(0,12);
    const favs = getFavs();
    favBtn.textContent = favs.includes(a.id) ? 'Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø© â˜…' : 'Ø§Ø¶Ù Ù„Ù„Ù…ÙØ¶Ù„Ø© â˜†';
    openBtn.onclick = ()=>{
      const q = encodeURIComponent(a.title + ' trailer');
      window.open('https://www.youtube.com/results?search_query='+q, '_blank');
    }
    shareBtn.onclick = ()=>{ copyToClipboard(window.location.href); alert('Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù†ÙØ³Ø®!'); }
    favBtn.onclick = ()=>{ toggleFav(a.id); favBtn.textContent = getFavs().includes(a.id) ? 'Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø© â˜…' : 'Ø§Ø¶Ù Ù„Ù„Ù…ÙØ¶Ù„Ø© â˜†'; }
  }

  function pushURL(id){
    if(!id) return;
    const u = new URL(window.location);
    u.searchParams.set('result', id);
    window.history.replaceState({}, '', u);
  }

  function readURL(){
    const u = new URL(window.location);
    const rid = parseInt(u.searchParams.get('result'));
    if(rid){
      const found = ANIME_DB.find(x=>x.id===rid);
      if(found) showResult(found);
    }
  }

  function toggleFav(id){
    const favs = getFavs();
    if(favs.includes(id)){ const idx = favs.indexOf(id); favs.splice(idx,1); } else favs.push(id);
    localStorage.setItem('myAnimeFavs', JSON.stringify(favs));
  }
  function getFavs(){ try{ return JSON.parse(localStorage.getItem('myAnimeFavs')||'[]'); }catch(e){return []} }
  function copyToClipboard(t){ navigator.clipboard?.writeText(t).catch(()=>{ const ta = document.createElement('textarea'); ta.value=t; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); }); }

  loadDB().then(()=>{ readURL(); });

  suggestBtn.addEventListener('click',suggest);
  randomBtn.addEventListener('click',suggestRandom);
  document.addEventListener('keydown',e=>{ if(e.key==='Enter') suggest(); });

</script>
</body>
</html>
